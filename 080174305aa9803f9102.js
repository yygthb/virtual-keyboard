(()=>{"use strict";function e({tagName:e="div",classNames:s="",child:t,attributes:i=[]}){const a=document.createElement(e);return s&&a.classList.add(...s.split(" ")),t&&"string"==typeof t?a.innerHTML=t:t&&Array.isArray(t)&&t.length&&t.forEach((e=>a.append(e))),i.forEach((([e,s])=>{e.match(/data-/)?a.dataset[e.slice(5)]=s:a.setAttribute(e,s)})),a}const s=["to swhtch keyboard language use Ctrl + Shift"],t=(e,s)=>{localStorage.setItem(e,JSON.stringify(s))};class i{constructor({code:e,key:s,shiftKey:t,className:i,isFunction:a}){this.code=e,this.key=s,this.shiftKey=t,this.className=i,this.isFunction=a||!1}render(){return this.primaryKeyNode=e({classNames:"key-code__primary",child:this.key}),this.secondaryKeyNode=e({classNames:"key-code__secondary",child:this.shiftKey}),this.container=e({tagName:"button",classNames:`${this.isFunction?"key-item key-item__function":"key-item"} ${this.className}`,child:[this.secondaryKeyNode,this.primaryKeyNode]}),this.shiftKey&&this.shiftKey.match(/[a-zA-Z–∞-—è–ê-–Ø0-9—ë–Å]/)&&this.container.classList.add("key-item__letter"),this}keydown(){return this.container.classList.add("active"),this.mouseOutHandler=this.keyup.bind(this),this.container.addEventListener("mouseout",this.mouseOutHandler),this}keyup(){return this.container.classList.remove("active"),this.container.removeEventListener("mouseout",this.mouseOutHandler),this}changeData({key:e,shiftKey:s}){return this.key=e,this.primaryKeyNode.textContent=e,this.shiftKey=s,this.secondaryKeyNode.textContent=s,this.container.classList.remove("key-item__letter"),s&&s.match(/[a-zA-Z–∞-—è–ê-–Ø0-9—ë–Å]/)&&this.container.classList.add("key-item__letter"),this}highlight(){this.container.classList.toggle("highlight")}}const a=document.querySelector("body"),y=function(){const t=e({tagName:"h1",classNames:"title",child:"Virtual Keyboard"}),i=e({tagName:"a",classNames:"about-link",child:"Virtual Keyboard",attributes:[["href","https://github.com/rolling-scopes-school/tasks/blob/master/tasks/virtual-keyboard/virtual-keyboard-en.md"],["target","_blank"]]}),a=e({tagName:"p",classNames:"about",child:["RSSchool #stage1 ",i," task"]}),y=e({tagName:"ul",classNames:"info-items",child:s.map((s=>e({tagName:"li",classNames:"info-item",child:s})))});return e({classNames:"intro",child:[t,a,y]})}(),c=e({tagName:"textarea",classNames:"textarea",attributes:[["cols",50],["rows",10],["name","textarea"]]}),h=new class{constructor(e,s){this.langLayouts=e,this.kbKit=s,this.cursorPosition=0,this.langLayoutCount=0,this.kbLang=this.#e()}#e(){let e=("kb-lang",JSON.parse(localStorage.getItem("kb-lang")));return e?Object.keys(this.langLayouts).forEach(((s,t)=>{s===e&&(this.langLayoutCount=t)})):[e]=Object.keys(this.langLayouts),t("kb-lang",e),e}#s(){const e=Object.keys(this.langLayouts);this.langLayoutCount!==e.length-1?this.langLayoutCount+=1:this.langLayoutCount=0;const s=e[this.langLayoutCount];t("kb-lang",s),this.kbLang=s}init(){return this.container=e({classNames:"keyboard",child:e({classNames:"box"})}),this.#t(),this}#t(){this.container.replaceChildren(),this.keys=[],this.kbKit.forEach((s=>{const t=e({classNames:"keys-row"});s.forEach((e=>{const s=this.langLayouts[this.kbLang][e];if(s){const a=new i({code:e,...s}).render();a.container.addEventListener("mousedown",this.#i.bind(this,a)),a.container.addEventListener("mouseup",this.#a.bind(this,a)),this.keys.push(a),t.append(a.container)}})),this.container.append(t)}))}output(e){return this.textarea=e,this.textarea.focus(),this.textarea.addEventListener("click",(e=>{e.preventDefault(),this.cursorPosition=this.textarea.selectionStart})),this.#y(),this}#y(){return window.addEventListener("keydown",(e=>{e.preventDefault();const s=e.code;this.keys.forEach((e=>{e.code===s&&this.#i.call(this,e)}))})),window.addEventListener("keyup",(e=>{e.preventDefault();const s=e.code;this.keys.forEach((e=>{e.code===s&&this.#a.call(this,e)}))})),this}#i(e){if(e.keydown(),e.isFunction||(this.isShiftActive?this.textarea.value=this.#c(this.cursorPosition,e.shiftKey):this.textarea.value=this.#c(this.cursorPosition,e.key),this.cursorPosition+=1,this.textarea.selectionEnd=this.cursorPosition),"Enter"===e.code&&(this.textarea.value=this.#c(this.cursorPosition,"\n"),this.cursorPosition+=1,this.textarea.selectionEnd=this.cursorPosition),"Tab"===e.code&&(this.textarea.value=this.#c(this.cursorPosition,"\t"),this.cursorPosition+=1,this.textarea.selectionEnd=this.cursorPosition),"ArrowLeft"===e.code&&this.cursorPosition>0&&(this.cursorPosition-=1,this.textarea.selectionEnd=this.cursorPosition),"ArrowRight"===e.code&&this.cursorPosition<this.textarea.value.length&&(this.cursorPosition+=1,this.textarea.selectionStart=this.cursorPosition),"ArrowUp"===e.code&&(this.textarea.value=this.#c(this.cursorPosition,"‚Æù"),this.cursorPosition+=1,this.textarea.selectionEnd=this.cursorPosition),"ArrowDown"===e.code&&(this.textarea.value=this.#c(this.cursorPosition,"‚Æü"),this.cursorPosition+=1,this.textarea.selectionEnd=this.cursorPosition),"Backspace"===e.code&&this.cursorPosition>0){const e=this.textarea.value;this.textarea.value=`${e.substring(0,this.cursorPosition-1)}${e.substring(this.cursorPosition)}`,this.cursorPosition-=1,this.textarea.selectionEnd=this.cursorPosition}if("Delete"===e.code){const e=this.textarea.value;this.textarea.value=`${e.substring(0,this.cursorPosition)}${e.substring(this.cursorPosition+1)}`,this.textarea.selectionEnd=this.cursorPosition}return"CapsLk"===e.key&&(this.isCapitalCase=!this.isCapitalCase,e.highlight(),this.#h()),"Ctrl"===e.key&&(this.isCtrlActive=!0,this.isShiftActive&&this.#n()),"Shift"===e.key&&(this.isShiftActive=!0,this.container.classList.add("shift"),this.isCtrlActive&&this.#n()),this}#n(){this.#s(),this.keys.forEach((e=>{if(!e.isFunction){const{key:s,shiftKey:t}=this.langLayouts[this.kbLang][e.code];e.changeData({key:s,shiftKey:t})}})),this.isCapitalCase&&this.#h()}#h(){this.keys.forEach((e=>{if(!e.isFunction&&e.key&&e.key.match(/[a-zA-Z–∞-—è–ê-–Ø—ë–Å]/)){const{key:s,shiftKey:t}=this.langLayouts[this.kbLang][e.code];this.isCapitalCase?e.changeData({key:t,shiftKey:s}):e.changeData({key:s,shiftKey:t})}}))}#a(e){return"Ctrl"===e.key&&(this.isCtrlActive=!1),"Shift"===e.key&&(this.container.classList.remove("shift"),this.isShiftActive=!1),e.keyup(),this.textarea.focus(),this}#c(e,s){const t=this.textarea.value;return`${t.substring(0,e)}${s}${t.substring(e)}`}}({en:{AltLeft:{key:"Alt",shiftKey:null,className:"altLeft",isFunction:!0},AltRight:{key:"Alt",shiftKey:null,className:"altRight",isFunction:!0},ArrowDown:{key:"ü†ó",shiftKey:null,className:"arrowDown",isFunction:!0},ArrowLeft:{key:"ü†î",shiftKey:null,className:"arrowLeft",isFunction:!0},ArrowRight:{key:"ü†ñ",shiftKey:null,className:"arrowRight",isFunction:!0},ArrowUp:{key:"ü†ï",shiftKey:null,className:"arrowUp",isFunction:!0},Backquote:{key:"`",shiftKey:"~",className:"backquote"},Backslash:{key:"\\",shiftKey:"|",className:"backslash"},Backspace:{key:"Backspace",shiftKey:null,className:"backspace",isFunction:!0},BracketLeft:{key:"[",shiftKey:"{",className:"bracketLeft"},BracketRight:{key:"]",shiftKey:"}",className:"bracketRight"},CapsLock:{key:"CapsLk",shiftKey:null,className:"caps",isFunction:!0},Comma:{key:",",shiftKey:"<",className:"comma"},ControlLeft:{key:"Ctrl",shiftKey:null,className:"controlLeft",isFunction:!0},ControlRight:{key:"Ctrl",shiftKey:null,className:"controlRight",isFunction:!0},Delete:{key:"Del",shiftKey:null,className:"delete",isFunction:!0},Digit0:{key:"0",shiftKey:")",className:"digit0"},Digit1:{key:"1",shiftKey:"!",className:"digit1"},Digit2:{key:"2",shiftKey:"@",className:"digit2"},Digit3:{key:"3",shiftKey:"#",className:"digit3"},Digit4:{key:"4",shiftKey:"$",className:"digit4"},Digit5:{key:"5",shiftKey:"%",className:"digit5"},Digit6:{key:"6",shiftKey:"^",className:"digit6"},Digit7:{key:"7",shiftKey:"&",className:"digit7"},Digit8:{key:"8",shiftKey:"*",className:"digit8"},Digit9:{key:"9",shiftKey:"(",className:"digit9"},Enter:{key:"Enter",shiftKey:null,className:"enter",isFunction:!0},Equal:{key:"=",shiftKey:"+",className:"equal"},KeyA:{key:"a",shiftKey:"A",className:"keyA"},KeyB:{key:"b",shiftKey:"B",className:"keyB"},KeyC:{key:"c",shiftKey:"C",className:"keyC"},KeyD:{key:"d",shiftKey:"D",className:"keyD"},KeyE:{key:"e",shiftKey:"E",className:"keyE"},KeyF:{key:"f",shiftKey:"F",className:"keyF"},KeyG:{key:"g",shiftKey:"G",className:"keyG"},KeyH:{key:"h",shiftKey:"H",className:"keyH"},KeyI:{key:"i",shiftKey:"I",className:"keyI"},KeyJ:{key:"j",shiftKey:"J",className:"keyJ"},KeyK:{key:"k",shiftKey:"K",className:"keyK"},KeyL:{key:"l",shiftKey:"L",className:"keyL"},KeyM:{key:"m",shiftKey:"M",className:"keyM"},KeyN:{key:"n",shiftKey:"N",className:"keyN"},KeyO:{key:"o",shiftKey:"O",className:"keyO"},KeyP:{key:"p",shiftKey:"P",className:"keyP"},KeyQ:{key:"q",shiftKey:"Q",className:"keyQ"},KeyR:{key:"r",shiftKey:"R",className:"keyR"},KeyS:{key:"s",shiftKey:"S",className:"keyS"},KeyT:{key:"t",shiftKey:"T",className:"keyT"},KeyU:{key:"u",shiftKey:"U",className:"keyU"},KeyV:{key:"v",shiftKey:"V",className:"keyV"},KeyW:{key:"w",shiftKey:"W",className:"keyW"},KeyX:{key:"x",shiftKey:"X",className:"keyX"},KeyY:{key:"y",shiftKey:"Y",className:"keyY"},KeyZ:{key:"z",shiftKey:"Z",className:"keyZ"},MetaLeft:{key:"‚äû",shiftKey:null,className:"metaLeft",isFunction:!0},Minus:{key:"-",shiftKey:"_",className:"minus"},Period:{key:".",shiftKey:">",className:"period"},Quote:{key:"'",shiftKey:'"',className:"quote"},Semicolon:{key:";",shiftKey:":",className:"semicolon"},ShiftLeft:{key:"Shift",shiftKey:null,className:"shiftLeft",isFunction:!0},ShiftRight:{key:"Shift",shiftKey:null,className:"shiftRight",isFunction:!0},Slash:{key:"/",shiftKey:"?",className:"slash"},Space:{key:" ",shiftKey:" ",className:"space"},Tab:{key:"Tab",shiftKey:null,className:"tab",isFunction:!0}},ru:{AltLeft:{key:"Alt",shiftKey:null,className:"altLeft",isFunction:!0},AltRight:{key:"Alt",shiftKey:null,className:"altRight",isFunction:!0},ArrowDown:{key:"ü†ó",shiftKey:null,className:"arrowDown",isFunction:!0},ArrowLeft:{key:"ü†î",shiftKey:null,className:"arrowLeft",isFunction:!0},ArrowRight:{key:"ü†ñ",shiftKey:null,className:"arrowRight",isFunction:!0},ArrowUp:{key:"ü†ï",shiftKey:null,className:"arrowUp",isFunction:!0},Backquote:{key:"—ë",shiftKey:"–Å",className:"backquote"},Backslash:{key:"\\",shiftKey:"/",className:"backslash"},Backspace:{key:"Backspace",shiftKey:null,className:"backspace",isFunction:!0},BracketLeft:{key:"—Ö",shiftKey:"–•",className:"bracketLeft"},BracketRight:{key:"—ä",shiftKey:"–™",className:"bracketRight"},CapsLock:{key:"CapsLk",shiftKey:null,className:"caps",isFunction:!0},Comma:{key:"–±",shiftKey:"–ë",className:"comma"},ControlLeft:{key:"Ctrl",shiftKey:null,className:"controlLeft",isFunction:!0},ControlRight:{key:"Ctrl",shiftKey:null,className:"controlRight",isFunction:!0},Delete:{key:"Del",shiftKey:null,className:"delete",isFunction:!0},Digit0:{key:"0",shiftKey:")",className:"digit0"},Digit1:{key:"1",shiftKey:"!",className:"digit1"},Digit2:{key:"2",shiftKey:'"',className:"digit2"},Digit3:{key:"3",shiftKey:"‚Ññ",className:"digit3"},Digit4:{key:"4",shiftKey:";",className:"digit4"},Digit5:{key:"5",shiftKey:"%",className:"digit5"},Digit6:{key:"6",shiftKey:":",className:"digit6"},Digit7:{key:"7",shiftKey:"?",className:"digit7"},Digit8:{key:"8",shiftKey:"*",className:"digit8"},Digit9:{key:"9",shiftKey:"(",className:"digit9"},Enter:{key:"Enter",shiftKey:null,className:"enter",isFunction:!0},Equal:{key:"=",shiftKey:"+",className:"equal"},KeyA:{key:"—Ñ",shiftKey:"–§",className:"keyA"},KeyB:{key:"–∏",shiftKey:"–ò",className:"keyB"},KeyC:{key:"—Å",shiftKey:"–°",className:"keyC"},KeyD:{key:"–≤",shiftKey:"–í",className:"keyD"},KeyE:{key:"—É",shiftKey:"–£",className:"keyE"},KeyF:{key:"–∞",shiftKey:"–ê",className:"keyF"},KeyG:{key:"–ø",shiftKey:"–ü",className:"keyG"},KeyH:{key:"—Ä",shiftKey:"–†",className:"keyH"},KeyI:{key:"—à",shiftKey:"–®",className:"keyI"},KeyJ:{key:"–æ",shiftKey:"–û",className:"keyJ"},KeyK:{key:"–ª",shiftKey:"–õ",className:"keyK"},KeyL:{key:"–¥",shiftKey:"–î",className:"keyL"},KeyM:{key:"—å",shiftKey:"–¨",className:"keyM"},KeyN:{key:"—Ç",shiftKey:"–¢",className:"keyN"},KeyO:{key:"—â",shiftKey:"–©",className:"keyO"},KeyP:{key:"–∑",shiftKey:"–ó",className:"keyP"},KeyQ:{key:"–π",shiftKey:"–ô",className:"keyQ"},KeyR:{key:"–∫",shiftKey:"–ö",className:"keyR"},KeyS:{key:"—ã",shiftKey:"–´",className:"keyS"},KeyT:{key:"–µ",shiftKey:"–ï",className:"keyT"},KeyU:{key:"–≥",shiftKey:"–ì",className:"keyU"},KeyV:{key:"–º",shiftKey:"–ú",className:"keyV"},KeyW:{key:"—Ü",shiftKey:"–¶",className:"keyW"},KeyX:{key:"—á",shiftKey:"–ß",className:"keyX"},KeyY:{key:"–Ω",shiftKey:"–ù",className:"keyY"},KeyZ:{key:"—è",shiftKey:"–Ø",className:"keyZ"},MetaLeft:{key:"‚äû",shiftKey:null,className:"metaLeft",isFunction:!0},Minus:{key:"-",shiftKey:"_",className:"minus"},Period:{key:"—é",shiftKey:"–Æ",className:"period"},Quote:{key:"—ç",shiftKey:"–≠",className:"quote"},Semicolon:{key:"–∂",shiftKey:"–ñ",className:"semicolon"},ShiftLeft:{key:"Shift",shiftKey:null,className:"shiftLeft",isFunction:!0},ShiftRight:{key:"Shift",shiftKey:null,className:"shiftRight",isFunction:!0},Slash:{key:".",shiftKey:",",className:"slash"},Space:{key:" ",shiftKey:" ",className:"space"},Tab:{key:"Tab",shiftKey:null,className:"tab",isFunction:!0}}},[["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Backspace"],["Tab","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash"],["CapsLock","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Enter"],["ShiftLeft","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","ShiftRight","Delete"],["ControlLeft","MetaLeft","AltLeft","Space","AltRight","ControlRight","ArrowLeft","ArrowUp","ArrowDown","ArrowRight"]]).init(),n=e({attributes:[["id","app"]],child:[y,c,h.container]});a.prepend(n),h.output(c)})();